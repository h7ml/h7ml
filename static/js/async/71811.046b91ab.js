/*! For license information please see 71811.046b91ab.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["71811"],{87993:function(e,n,r){"use strict";r.r(n);var s=r("52676"),d=r("40453");function i(e){let n=Object.assign({h2:"h2",a:"a",p:"p",h3:"h3",code:"code",pre:"pre"},(0,d.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h2,{id:"selenium",children:["selenium",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#selenium",children:"#"})]}),"\n",(0,s.jsxs)(n.h2,{id:"scrapy--selenium-\u6293\u53D6\u52A8\u6001\u9875\u9762",children:["scrapy + selenium \u6293\u53D6\u52A8\u6001\u9875\u9762",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#scrapy--selenium-\u6293\u53D6\u52A8\u6001\u9875\u9762",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/2016732",target:"_blank",rel:"noopener noreferrer",children:"\u817E\u8BAF\u4E91\u535A\u5BA2 open in new window"})}),"\n",(0,s.jsxs)(n.h3,{id:"\u5B89\u88C5-selenium",children:["\u5B89\u88C5 selenium",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B89\u88C5-selenium",children:"#"})]}),"\n",(0,s.jsxs)(n.h3,{id:"\u4E0B\u8F7D-selenium-\u8C03\u8BD5\u5DE5\u5177",children:["\u4E0B\u8F7D selenium \u8C03\u8BD5\u5DE5\u5177",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E0B\u8F7D-selenium-\u8C03\u8BD5\u5DE5\u5177",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["Chrome",(0,s.jsx)(n.a,{href:"https://registry.npmmirror.com/binary.html?path=chromedriver/",target:"_blank",rel:"noopener noreferrer",children:"\u4E0B\u8F7D\u5730\u5740 open in new window"}),"\uFF0C\u7248\u672C\u4E0E Chrome \u6700\u8FD1\u5373\u53EF"]}),"\n",(0,s.jsxs)(n.h3,{id:"\u4F7F\u7528",children:["\u4F7F\u7528",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4F7F\u7528",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["1\u3001\u5728 ",(0,s.jsx)(n.code,{children:"middlewares.py"})," \u6587\u4EF6\u4E2D\u4FEE\u6539\u8FD4\u56DE\u7684 ",(0,s.jsx)(n.code,{children:"response"})," \u5BF9\u8C61"]}),"\n",(0,s.jsxs)(n.p,{children:["\u627E\u5230 ",(0,s.jsx)(n.code,{children:"Scrapy[\u8FD9\u91CC\u662F\u4F60\u7684\u9879\u76EE\u540D\u5B57]sDownloaderMiddleware"})," \u7C7B\uFF0C\u4FEE\u6539",(0,s.jsx)(n.code,{children:"process_request"}),"\u65B9\u6CD5"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:" def process_request(self, request, spider):\n\n        # \u5728 DownloaderMiddleware \u4E2D\u66F4\u6539 process_request \u8FD4\u56DE\u7684 response \u5BF9\u8C61\n        # \u901A\u8FC7 webdriver \u6784\u5EFA\u7684 driver \u5BF9\u8C61\u53BB\u8BF7\u6C42js\u6E32\u67D3\u540E\u7684\u9875\u9762\n        options = webdriver.ChromeOptions()\n        options.add_argument('--headless')  # \u6D4F\u89C8\u5668\u4E0D\u63D0\u4F9B\u53EF\u89C6\u5316\u754C\u9762\u3002Linux\u4E0B\u5982\u679C\u7CFB\u7EDF\u4E0D\u652F\u6301\u53EF\u89C6\u5316\u4E0D\u52A0\u8FD9\u6761\u4F1A\u542F\u52A8\u5931\u8D25\n        options.add_argument('blink-settings=imagesEnabled=false')  # \u4E0D\u52A0\u8F7D\u56FE\u7247\uFF0C\u63D0\u5347\u8FD0\u884C\u901F\u5EA6\n        options.add_argument('--disable-gpu')  # \u8C37\u6B4C\u6587\u6863\u63D0\u5230\u9700\u8981\u52A0\u4E0A\u8FD9\u4E2A\u5C5E\u6027\u6765\u89C4\u907Fbug\n        options.add_argument(\"no-sandbox\")  # \u53D6\u6D88\u6C99\u76D2\u6A21\u5F0F\n        options.add_argument(\"disable-blink-features=AutomationControlled\")  # \u7981\u7528\u542F\u7528Blink\u8FD0\u884C\u65F6\u7684\u529F\u80FD\n        options.add_experimental_option('excludeSwitches', ['enable-automation'])    # \u5F00\u53D1\u8005\u6A21\u5F0F\n\n        # executable_path \u662F\u4F60\u7684 selenium \u8C03\u8BD5\u5DE5\u5177\u7684\u8DEF\u5F84\n        driver = webdriver.Chrome(executable_path='/Users/mulin/Chrome/chromedriver', options=options)\n        # \u79FB\u9664 `window.navigator.webdriver`. scrapy \u9ED8\u8BA4\u4E3ATrue\n        driver.execute_cdp_cmd(\"Page.addScriptToEvaluateOnNewDocument\", {\n            \"source\": \"\"\"\n                     Object.defineProperty(navigator, 'webdriver', {\n                       get: () =&gt; undefined\n                     })\n                   \"\"\"\n        })\n\n        driver.get(request.url)\n        driver.implicitly_wait(5)\n        content = driver.page_source\n        # \u5173\u95ED webdriver\n        driver.quit()\n\n        # \u5F15\u5165 HtmlResponse \u51FD\u6570\u6765\u91CD\u65B0\u8FD4\u56DE response \u5BF9\u8C61\n        return HtmlResponse(url=request.url, body=content, request=request, encoding='utf-8')\n"})}),"\n",(0,s.jsxs)(n.p,{children:["3\u3001\u5728",(0,s.jsx)(n.code,{children:"settings.py"}),"\u6587\u4EF6\u4E2D\u6253\u5F00",(0,s.jsx)(n.code,{children:"SPIDER_MIDDLEWARES"})," \u3001",(0,s.jsx)(n.code,{children:"DOWNLOADER_MIDDLEWARES"})," \u548C",(0,s.jsx)(n.code,{children:"DOWNLOAD_DELAY"}),"\u914D\u7F6E"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Configure a delay for requests for the same website (default: 0)\n# See https://docs.scrapy.org/en/latest/topics/settings.html#download-delay\n# See also autothrottle settings and docs\nDOWNLOAD_DELAY = 2\n\n......\n\n# Enable or disable spider middlewares\n# See https://docs.scrapy.org/en/latest/topics/spider-middleware.html\nSPIDER_MIDDLEWARES = {\n   'scrapy_yys.middlewares.ScrapyYysSpiderMiddleware': 543,\n}\n\n# Enable or disable downloader middlewares\n# See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html\nDOWNLOADER_MIDDLEWARES = {\n   'scrapy_yys.middlewares.ScrapyYysDownloaderMiddleware': 543,\n}\n"})})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}n.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["up%2FPython%2Fselenium.md"]={toc:[{text:"selenium",id:"selenium",depth:2},{text:"scrapy + selenium \u6293\u53D6\u52A8\u6001\u9875\u9762",id:"scrapy--selenium-\u6293\u53D6\u52A8\u6001\u9875\u9762",depth:2},{text:"\u5B89\u88C5 selenium",id:"\u5B89\u88C5-selenium",depth:3},{text:"\u4E0B\u8F7D selenium \u8C03\u8BD5\u5DE5\u5177",id:"\u4E0B\u8F7D-selenium-\u8C03\u8BD5\u5DE5\u5177",depth:3},{text:"\u4F7F\u7528",id:"\u4F7F\u7528",depth:3}],title:"selenium",frontmatter:{icon:"python",order:3,date:"2022-05-20T00:00:00.000Z",author:"h7ml",category:"python",tag:"python",title:"selenium"}}}}]);