/*! For license information please see 51592.7787a619.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["51592"],{1828:function(e,n,t){"use strict";t.r(n);var r=t("52676"),s=t("40453");function a(e){let n=Object.assign({h2:"h2",a:"a",h3:"h3",strong:"strong",p:"p",pre:"pre",code:"code"},(0,s.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h2,{id:"vue-\u6E90\u7801\u5206\u6790",children:["vue \u6E90\u7801\u5206\u6790",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#vue-\u6E90\u7801\u5206\u6790",children:"#"})]}),"\n",(0,r.jsxs)(n.h3,{id:"",children:[(0,r.jsx)(n.strong,{children:"\u6838\u5FC3"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"Vue \u54CD\u5E94\u5F0F\u7684\u6838\u5FC3\u662F\u5229\u7528 Object.defineProperty()\u8FD9\u4E2A\u65B9\u6CD5\u8FDB\u884C\u6570\u636E\u52AB\u6301\u548C\u89C2\u5BDF\u8005\u6A21\u5F0F\u8FDB\u884C\u6570\u636E\u54CD\u5E94\u5F0F\u7684\u3002Object.defineProperty()\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u76F4\u63A5\u5728\u4E00\u4E2A\u5BF9\u8C61\u4E0A\u5B9A\u4E49\u4E00\u4E2A\u65B0\u5C5E\u6027\uFF0C\u6216\u8005\u4FEE\u6539\u4E00\u4E2A\u5BF9\u8C61\u7684\u73B0\u6709\u5C5E\u6027\uFF0C\u5E76\u8FD4\u56DE\u6B64\u5BF9\u8C61\u3002\u5177\u4F53\u7528\u6CD5\u5982\u4E0B\uFF1A"}),"\n",(0,r.jsx)(n.p,{children:"\u200B \u5B83\u6709\u4E09\u4E2A\u53C2\u6570\uFF0C\u7B2C\u4E00\u4E2A\u662F object\uFF0C\u5B83\u4EE3\u8868\u8981\u5B9A\u4E49\u5C5E\u6027\u7684\u5BF9\u8C61\u3002\uFF1B\u7B2C\u4E8C\u4E2A\u662F prop\uFF0C\u5B83\u4EE3\u8868\u76EE\u6807\u5BF9\u8C61\u7684\u5C5E\u6027\u503C\uFF1B\u7B2C\u4E09\u4E2A\u53C2\u6570\u662F descriptor\uFF0C\u5B83\u4EE3\u8868\u8981\u5B9A\u4E49\u6216\u4FEE\u6539\u7684\u5C5E\u6027\u63CF\u8FF0\u7B26\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u200B \u54CD\u5E94\u5F0F\u7528\u6CD5\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const person = {};\nObject.defineProperty(person, 'name', {\n  get: function () {\n    console.log('\u83B7\u53D6\u5230name\u4E86');\n  },\n  set: function (val) {\n    console.log('\u8BBE\u7F6E\u4E86name\u4E3A' + val);\n  },\n});\nperson.name; //\u83B7\u53D6\u5230name\u4E86\nperson.name = 'h7ml'; //\u8BBE\u7F6E\u4E86name\u4E3Ah7ml\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"-1",children:[(0,r.jsx)(n.strong,{children:"\u89C2\u5BDF\u8005\u6A21\u5F0F"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#-1",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u4EC0\u4E48\u662F\u89C2\u5BDF\u8005\u6A21\u5F0F\uFF1F\u5B83\u5206\u4E3A",(0,r.jsx)(n.strong,{children:"\u6CE8\u518C\u73AF\u8282\u8DDF\u53D1\u5E03\u73AF\u8282"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6BD4\u5982\u6211\u53BB\u4E70\u829D\u58EB\u86CB\u7CD5\uFF0C\u4F46\u662F\u5E97\u5BB6\u8FD8\u6CA1\u6709\u505A\u51FA\u6765\u3002\u8FD9\u65F6\u5019\u6211\u53C8\u4E0D\u60F3\u5728\u5E97\u5916\u9762\u50BB\u50BB\u7B49\uFF0C\u6211\u5C31\u9700\u8981\u9694\u4E00\u6BB5\u65F6\u95F4\u6765\u56DE\u6765\u95EE\u95EE\u86CB\u7CD5\u505A\u597D\u6CA1\uFF0C\u5BF9\u4E8E\u6211\u6765\u8BF4\u662F\u5F88\u9EBB\u70E6\u7684\u4E8B\u60C5\uFF0C\u8BF4\u4E0D\u5B9A\u6211\u5C31\u61D2\u5F97\u4E70\u4E86\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5E97\u5BB6\u80AF\u5B9A\u60F3\u8981\u505A\u751F\u610F\uFF0C\u4E0D\u60F3\u6D41\u5931\u6211\u8FD9\u4E2A\u5403\u8D27\u5BA2\u6237\u3002\u4E8E\u662F\uFF0C\u5728\u86CB\u7CD5\u6CA1\u6709\u505A\u597D\u7684\u8FD9\u6BB5\u65F6\u95F4\uFF0C\u6709\u5BA2\u6237\u6765\uFF0C\u4ED6\u4EEC\u5C31\u8BA9\u5BA2\u6237\u628A\u81EA\u5DF1\u7684\u7535\u8BDD\u7559\u4E0B\uFF0C\u8FD9\u5C31\u662F\u89C2\u5BDF\u8005\u6A21\u5F0F\u4E2D\u7684",(0,r.jsx)(n.strong,{children:"\u6CE8\u518C\u73AF\u8282"}),"\u3002\u7136\u540E\u86CB\u7CD5\u505A\u597D\u4E4B\u540E\uFF0C\u4E00\u6B21\u6027\u901A\u77E5\u6240\u6709\u8BB0\u5F55\u4E86\u7684\u5BA2\u6237\uFF0C\u8FD9\u5C31\u662F\u89C2\u5BDF\u8005\u7684",(0,r.jsx)(n.strong,{children:"\u53D1\u5E03\u73AF\u8282"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u4E00\u4E2A\u7B80\u5355\u7684\u89C2\u5BDF\u8005\u6A21\u5F0F\u7C7B\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function Observer() {\n  this.dep = [];\n\n  register(fn) {\n    this.dep.push(fn)\n  }\n\n  notify() {\n    this.dep.forEach(item => item())\n  }\n}\n\nconst wantCake = new Oberver();\n// \u6BCF\u6765\u4E00\u4E2A\u987E\u5BA2\u5C31\u6CE8\u518C\u4E00\u4E2A\u60F3\u6267\u884C\u7684\u51FD\u6570\nwantCake.register(() => {'console.log(\"call daisy\")'})\nwantCake.register(() => {'console.log(\"call anny\")'})\nwantCake.register(() => {'console.log(\"call sunny\")'})\n\n// \u6700\u540E\u86CB\u7CD5\u505A\u597D\u4E4B\u540E\uFF0C\u901A\u77E5\u6240\u6709\u7684\u5BA2\u6237\nwantCake.notify()\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"-2",children:[(0,r.jsx)(n.strong,{children:"\u521D\u59CB\u5316"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#-2",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["vue \u5728\u521D\u59CB\u5316\u6267\u884C initState \u7684\u65F6\u5019\uFF0C\u4F1A\u5BF9",(0,r.jsx)(n.code,{children:"props"}),"\u3001",(0,r.jsx)(n.code,{children:"methods"}),"\u3001",(0,r.jsx)(n.code,{children:"data"}),"\u3001",(0,r.jsx)(n.code,{children:"computed"})," \u548C ",(0,r.jsx)(n.code,{children:"wathcer"})," \u7B49\u5C5E\u6027\u505A\u521D\u59CB\u5316\u64CD\u4F5C\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"export function initState(vm: Component) {\n  vm._watchers = [];\n  const opts = vm.$options;\n  if (opts.props) initProps(vm, opts.props);\n  if (opts.methods) initMethods(vm, opts.methods);\n  if (opts.data) {\n    initData(vm);\n  } else {\n    observe((vm._data = {}), true /* asRootData */);\n  }\n  if (opts.computed) initComputed(vm, opts.computed);\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch);\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u521D\u59CB\u5316 data \u7684\u65F6\u5019\uFF0C\u4E00\u5171\u505A\u4E86\u4E24\u4EF6\u4E8B\uFF0C\u4E00\u4EF6\u662F\u5229\u7528 proxy \u5C06\u6570\u636E\u4EE3\u7406\u5230\u6574\u4E2A vue \u5B9E\u4F8B\u4E0A\uFF0C\u53E6\u4E00\u4EF6\u5C31\u662F\u5C06 data \u4E2D\u7684\u6240\u6709\u5BF9\u8C61\u5C5E\u6027 reactive \u5316\uFF0C\u53D8\u6210\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u4E3A\u5BF9\u8C61\u6DFB\u52A0 getter \u548C setter\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"/**\n * Observer class that is attached to each observed\n * object. Once attached, the observer converts the target\n * object's property keys into getter/setters that\n * collect dependencies and dispatch updates.\n */\nexport class Observer {\n  value: any;\n  dep: Dep;\n  vmCount: number; // number of vms that has this object as root $data\n\n  constructor(value: any) {\n    this.value = value;\n    this.dep = new Dep();\n    this.vmCount = 0;\n    def(value, '__ob__', this);\n    if (Array.isArray(value)) {\n      const augment = hasProto ? protoAugment : copyAugment;\n      augment(value, arrayMethods, arrayKeys);\n      this.observeArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n\n  /**\n   * Walk through each property and convert them into\n   * getter/setters. This method should only be called when\n   * value type is Object.\n   */\n\n  walk(obj: Object) {\n    const keys = Object.keys(obj);\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i]);\n    }\n  }\n\n  /**\n   * Observe a list of Array items.\n   */\n  observeArray(items: Array<any>) {\n    for (let i = 0, l = items.length; i < l; i++) {\n      observe(items[i]);\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4E0A\u9762\u7684\u8FD9\u6BB5\u4EE3\u7801\uFF0C\u5B83\u5C06\u5BF9\u8C61\u7684\u6240\u6709\u5C5E\u6027\u8FDB\u884C\u904D\u5386\u6267\u884C defineReactive()\u65B9\u6CD5\u8FDB\u884C\u54CD\u5E94\u5F0F\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"  walk (obj: Object) {\n    const keys = Object.keys(obj)\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i])\n    }\n  }\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u6267\u884C\u8FD9\u4E2A\u65B9\u6CD5\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A new \u4E00\u4E2A dep \u5B9E\u4F8B\uFF0C\u8BB0\u5F97\u6CE8\u610F\uFF0C\u540E\u9762\u4F1A\u7528\u5230"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function defineReactive(obj: Object, key: string, ...) {\n    const dep = new Dep()\n\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: function reactiveGetter () {\n        ....\n        dep.depend()\n        return value\n        ....\n      },\n      set: function reactiveSetter (newVal) {\n        ...\n        val = newVal\n        dep.notify()\n        ...\n      }\n    })\n  }\n\n  class Dep {\n      static target: ?Watcher;\n      subs: Array<Watcher>;\n\n      depend () {\n        if (Dep.target) {\n          Dep.target.addDep(this)\n        }\n      }\n\n      notify () {\n        const subs = this.subs.slice()\n        for (let i = 0, l = subs.length; i < l; i++) {\n          subs[i].update()\n        }\n      }\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u7684 Dep \u7C7B\u5C31\u662F\u4E00\u4E2A\u89C2\u5BDF\u8005\u7C7B\uFF0C\u6BCF\u4E2A\u5BF9\u8C61\u5C5E\u6027\u90FD\u4E00\u4E2A dep \u5B9E\u4F8B\u5BF9\u8C61\uFF0C\u5728\u6267\u884C get \u7684\u65F6\u5019\u8FDB\u884C\u89E6\u53D1 depend \u65B9\u6CD5\uFF0C\u89E6\u53D1 sit \u7684\u65F6\u5019\u6267\u884C notify \u65B9\u6CD5\u3002"}),"\n",(0,r.jsxs)(n.h3,{id:"-3",children:[(0,r.jsx)(n.strong,{children:"mount \u9636\u6BB5"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#-3",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5728 vue \u5B9E\u4F8B\u6302\u8F7D\u9636\u6BB5\uFF0C\u4F1A\u521B\u5EFA\u4E00\u4E2A Watcher \u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61\uFF0C\u8FD9\u4E2A Watcher \u5B9E\u9645\u4E0A\u662F\u8FDE\u63A5 Vue \u7EC4\u4EF6\u4E0E Dep\uFF08\u4E5F\u5C31\u662F\u89C6\u56FE\u66F4\u65B0\u73AF\u8282\uFF09\u7684\u6865\u6881\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"mountComponent(vm: Component, el: ?Element, ...) {\n    vm.$el = el\n\n    ...\n\n    updateComponent = () => {\n      vm._update(vm._render(), ...)\n    }\n\n    new Watcher(vm, updateComponent, ...)\n    ...\n}\n\nclass Watcher {\n  getter: Function;\n\n  // \u4EE3\u7801\u7ECF\u8FC7\u7B80\u5316\n  constructor(vm: Component, expOrFn: string | Function, ...) {\n    ...\n    this.getter = expOrFn\n    Dep.target = this                      // \u6CE8\u610F\u8FD9\u91CC\u5C06\u5F53\u524D\u7684Watcher\u8D4B\u503C\u7ED9\u4E86Dep.target\n    this.value = this.getter.call(vm, vm)  // \u8C03\u7528\u7EC4\u4EF6\u7684\u66F4\u65B0\u51FD\u6570\n    ...\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 rende()\u65B9\u6CD5\u5C06\u6A21\u677F\u6E32\u67D3\u6210\u865A\u62DF Vnode \u7684\u8FC7\u7A0B\u4E2D\u4F1A\u8BBF\u95EE data\uFF0C\u4ECE\u800C\u89E6\u53D1\u5C5E\u6027\u7684 getter\uFF0C\u7136\u540E\u6BCF\u4E2A\u5BF9\u8C61\u5C5E\u6027\u53C8\u6709\u4E00\u4E2A dep \u5B9E\u4F8B\u5BF9\u8C61\uFF08\u4E0A\u9762\u63D0\u5230\u7684\uFF09\uFF0C\u7136\u540E\u518D getter \u7684\u903B\u8F91\u4E2D\u53C8\u4F1A\u8C03\u7528\u8BE5 dep \u7684 depend \u65B9\u6CD5\uFF0C\u5C06 watcher \u5B9E\u4F8B add \u5230 sub\uFF08\u5B58\u5728 Dep \u7C7B\u4E2D\u7684\u5B58\u50A8 watcher \u7684\u6570\u7EC4\uFF09\u91CC\u9762\u3002\u5728 depend \u65B9\u6CD5\u91CC\u9762\uFF0CDep.target \u5C31\u662F watcher \u672C\u8EAB\uFF0C\u5728 Wacher \u7C7B\u4E2D\u7684\u6784\u9020\u51FD\u6570\u4F1A\u6267\u884C\uFF08\u4E0A\u9762\u4EE3\u7801\u6709\uFF09\u3002\u4EE5\u4E0A\u8FC7\u7A0B\u5C31\u53EB",(0,r.jsx)(n.strong,{children:"\u4F9D\u8D56\u6536\u96C6"}),"\u3002"]}),"\n",(0,r.jsxs)(n.h3,{id:"-4",children:[(0,r.jsx)(n.strong,{children:"\u6D3E\u53D1\u66F4\u65B0"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#-4",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5BF9\u8C61\u5C5E\u6027\u7684\u6570\u636E\u6539\u53D8\u4E4B\u540E\uFF0C\u4F1A\u89E6\u53D1 sitter\uFF0C\u4ECE\u800C\u6267\u884C sitter \u51FD\u6570\u7684\u903B\u8F91\uFF0C\u4ECE\u800C\u8C03\u7528 dep \u5B9E\u4F8B\u7684 notify \u65B9\u6CD5\uFF0C\u4ECE\u800C\u8FDB\u884C\u904D\u5386\u8C03\u7528 sub \u4E2D\u6240\u6709 watcher \u7684 upadte \u65B9\u6CD5\u8FDB\u884C\u89C6\u56FE\u66F4\u65B0\u3002"}),"\n",(0,r.jsxs)(n.h3,{id:"-5",children:[(0,r.jsx)(n.strong,{children:"\u603B\u7ED3"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#-5",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"**\u7B2C\u4E00\u6B65\uFF1A**\u7EC4\u4EF6\u521D\u59CB\u5316\u7684\u65F6\u5019\uFF0C\u5148\u7ED9\u6BCF\u4E00\u4E2A Data \u5C5E\u6027\u90FD\u6CE8\u518C getter\uFF0Csetter\uFF0C\u4E5F\u5C31\u662F reactive \u5316\u3002\u7136\u540E\u518D new \u4E00\u4E2A\u81EA\u5DF1\u7684 Watcher \u5BF9\u8C61\uFF0C\u6B64\u65F6 watcher \u4F1A\u7ACB\u5373\u8C03\u7528\u7EC4\u4EF6\u7684 render \u51FD\u6570\u53BB\u751F\u6210\u865A\u62DF DOM\u3002\u5728\u8C03\u7528 render \u7684\u65F6\u5019\uFF0C\u5C31\u4F1A\u9700\u8981\u7528\u5230 data \u7684\u5C5E\u6027\u503C\uFF0C\u6B64\u65F6\u4F1A\u89E6\u53D1 getter \u51FD\u6570\uFF0C\u5C06\u5F53\u524D\u7684 Watcher \u51FD\u6570\u6CE8\u518C\u8FDB sub \u91CC\u3002"}),"\n",(0,r.jsx)(n.p,{children:"**\u7B2C\u4E8C\u6B65\uFF1A**\u5F53 data \u5C5E\u6027\u53D1\u751F\u6539\u53D8\u4E4B\u540E\uFF0C\u4F1A\u89E6\u53D1 sitter\uFF0C\u904D\u5386 sub \u91CC\u6240\u6709\u7684 watcher \u5BF9\u8C61\uFF0C\u901A\u77E5\u5B83\u4EEC\u53BB\u91CD\u65B0\u6E32\u67D3\u7EC4\u4EF6\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6CE8\u610F\uFF1Avue \u5BF9\u6570\u7EC4\u54CD\u5E94\u5F0F\u662F\u901A\u8FC7\u53D8\u5F02\u65B9\u6CD5\u5B8C\u6210\u7684\uFF0C\u800C\u4E14\u5982\u679C\u8981\u5BF9\u54CD\u5E94\u5F0F\u5BF9\u8C61\u6DFB\u52A0\u65B0\u7684\u5C5E\u6027\uFF0C\u5FC5\u987B\u8981\u7528$set \u65B9\u6CD5\u624D\u80FD\u5B8C\u6210"}),"\n",(0,r.jsx)(n.p,{children:"\u53C2\u8003\u6587\u7AE0\uFF1A"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://ustbhuangyi.github.io/vue-analysis/v2/reactive/",target:"_blank",rel:"noopener noreferrer",children:"vue \u6280\u672F\u63ED\u79D8"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/88648401",target:"_blank",rel:"noopener noreferrer",children:"\u6700\u7B80\u5316 VUE \u7684\u54CD\u5E94\u5F0F\u539F\u7406"})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}n.default=i,i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["posts%2Fvue%2Findex.md"]={toc:[{text:"vue \u6E90\u7801\u5206\u6790",id:"vue-\u6E90\u7801\u5206\u6790",depth:2},{text:"**\u6838\u5FC3**",id:"\u6838\u5FC3",depth:3},{text:"**\u89C2\u5BDF\u8005\u6A21\u5F0F**",id:"\u89C2\u5BDF\u8005\u6A21\u5F0F",depth:3},{text:"**\u521D\u59CB\u5316**",id:"\u521D\u59CB\u5316",depth:3},{text:"**mount \u9636\u6BB5**",id:"mount-\u9636\u6BB5",depth:3},{text:"**\u6D3E\u53D1\u66F4\u65B0**",id:"\u6D3E\u53D1\u66F4\u65B0",depth:3},{text:"**\u603B\u7ED3**",id:"\u603B\u7ED3",depth:3}],title:"vue",frontmatter:{icon:"vue",date:"2021-06-27T00:00:00.000Z",author:"h7ml",title:"vue",category:"vue",tag:"vue",star:!0,index:!0,dir:{order:6}}}}}]);