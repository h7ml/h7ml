/*! For license information please see 28835.4c602275.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["28835"],{48970:function(e,n,r){"use strict";r.r(n);var t=r("52676"),s=r("40453");function a(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",code:"code",strong:"strong",blockquote:"blockquote",pre:"pre",ul:"ul",li:"li"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"vueobservable-\u4F60\u6709\u4E86\u89E3\u8FC7\u5417\u8BF4\u8BF4\u770B",children:["Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#vueobservable-\u4F60\u6709\u4E86\u89E3\u8FC7\u5417\u8BF4\u8BF4\u770B",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://nakoruru.h7ml.cn/httpproxy/static.5ibug.net/vitepress/assets/images/interview/193782e0-3e7b-11eb-ab90-d9ae814b240d.png",alt:""})}),"\n",(0,t.jsxs)(n.h2,{id:"\u4E00observable-\u662F\u4EC0\u4E48",children:["\u4E00\u3001Observable \u662F\u4EC0\u4E48",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E00observable-\u662F\u4EC0\u4E48",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Observable"})," \u7FFB\u8BD1\u8FC7\u6765\u6211\u4EEC\u53EF\u4EE5\u7406\u89E3\u6210",(0,t.jsx)(n.strong,{children:"\u53EF\u89C2\u5BDF\u7684"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u6211\u4EEC\u5148\u6765\u770B\u4E00\u4E0B\u5176\u5728",(0,t.jsx)(n.code,{children:"Vue"}),"\u4E2D\u7684\u5B9A\u4E49"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Vue.observable"}),"\uFF0C\u8BA9\u4E00\u4E2A\u5BF9\u8C61\u53D8\u6210\u54CD\u5E94\u5F0F\u6570\u636E\u3002",(0,t.jsx)(n.code,{children:"Vue"})," \u5185\u90E8\u4F1A\u7528\u5B83\u6765\u5904\u7406 ",(0,t.jsx)(n.code,{children:"data"})," \u51FD\u6570\u8FD4\u56DE\u7684\u5BF9\u8C61"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u8FD4\u56DE\u7684\u5BF9\u8C61\u53EF\u4EE5\u76F4\u63A5\u7528\u4E8E\u6E32\u67D3\u51FD\u6570\u548C\u8BA1\u7B97\u5C5E\u6027\u5185\uFF0C\u5E76\u4E14\u4F1A\u5728\u53D1\u751F\u53D8\u66F4\u65F6\u89E6\u53D1\u76F8\u5E94\u7684\u66F4\u65B0\u3002\u4E5F\u53EF\u4EE5\u4F5C\u4E3A\u6700\u5C0F\u5316\u7684\u8DE8\u7EC4\u4EF6\u72B6\u6001\u5B58\u50A8\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"Vue.observable({ count: 1 })\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5176\u4F5C\u7528\u7B49\u540C\u4E8E"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"new vue({ count: 1 })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 ",(0,t.jsx)(n.code,{children:"Vue 2.x"})," \u4E2D\uFF0C\u88AB\u4F20\u5165\u7684\u5BF9\u8C61\u4F1A\u76F4\u63A5\u88AB ",(0,t.jsx)(n.code,{children:"Vue.observable"})," \u53D8\u66F4\uFF0C\u5B83\u548C\u88AB\u8FD4\u56DE\u7684\u5BF9\u8C61\u662F\u540C\u4E00\u4E2A\u5BF9\u8C61"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 ",(0,t.jsx)(n.code,{children:"Vue 3.x"})," \u4E2D\uFF0C\u5219\u4F1A\u8FD4\u56DE\u4E00\u4E2A\u53EF\u54CD\u5E94\u7684\u4EE3\u7406\uFF0C\u800C\u5BF9\u6E90\u5BF9\u8C61\u76F4\u63A5\u8FDB\u884C\u53D8\u66F4\u4ECD\u7136\u662F\u4E0D\u53EF\u54CD\u5E94\u7684"]}),"\n",(0,t.jsxs)(n.h2,{id:"\u4E8C\u4F7F\u7528\u573A\u666F",children:["\u4E8C\u3001\u4F7F\u7528\u573A\u666F",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E8C\u4F7F\u7528\u573A\u666F",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u975E\u7236\u5B50\u7EC4\u4EF6\u901A\u4FE1\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u901A\u5E38\u7684",(0,t.jsx)(n.code,{children:"bus"}),"\u6216\u8005\u4F7F\u7528",(0,t.jsx)(n.code,{children:"vuex"}),"\uFF0C\u4F46\u662F\u5B9E\u73B0\u7684\u529F\u80FD\u4E0D\u662F\u592A\u590D\u6742\uFF0C\u800C\u4F7F\u7528\u4E0A\u9762\u4E24\u4E2A\u53C8\u6709\u70B9\u7E41\u7410\u3002\u8FD9\u65F6\uFF0C",(0,t.jsx)(n.code,{children:"observable"}),"\u5C31\u662F\u4E00\u4E2A\u5F88\u597D\u7684\u9009\u62E9"]}),"\n",(0,t.jsxs)(n.p,{children:["\u521B\u5EFA\u4E00\u4E2A",(0,t.jsx)(n.code,{children:"js"}),"\u6587\u4EF6"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// \u5F15\u5165vue\nimport Vue from 'vue\n// \u521B\u5EFAstate\u5BF9\u8C61\uFF0C\u4F7F\u7528observable\u8BA9state\u5BF9\u8C61\u53EF\u54CD\u5E94\nexport let state = Vue.observable({\n  name: '\u5F20\u4E09',\n  'age': 38\n})\n// \u521B\u5EFA\u5BF9\u5E94\u7684\u65B9\u6CD5\nexport let mutations = {\n  changeName(name) {\n    state.name = name\n  },\n  setAge(age) {\n    state.age = age\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728",(0,t.jsx)(n.code,{children:".vue"}),"\u6587\u4EF6\u4E2D\u76F4\u63A5\u4F7F\u7528\u5373\u53EF"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'<template>\n  <div>\n    \u59D3\u540D\uFF1A{{ name }}\n    \u5E74\u9F84\uFF1A{{ age }}\n    <button @click="changeName(\'\u674E\u56DB\')">\u6539\u53D8\u59D3\u540D</button>\n    <button @click="setAge(18)">\u6539\u53D8\u5E74\u9F84</button>\n  </div>\n</template>\nimport { state, mutations } from \'@/store\nexport default {\n  // \u5728\u8BA1\u7B97\u5C5E\u6027\u4E2D\u62FF\u5230\u503C\n  computed: {\n    name() {\n      return state.name\n    },\n    age() {\n      return state.age\n    }\n  },\n  // \u8C03\u7528mutations\u91CC\u9762\u7684\u65B9\u6CD5\uFF0C\u66F4\u65B0\u6570\u636E\n  methods: {\n    changeName: mutations.changeName,\n    setAge: mutations.setAge\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h2,{id:"\u4E09\u539F\u7406\u5206\u6790",children:["\u4E09\u3001\u539F\u7406\u5206\u6790",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E09\u539F\u7406\u5206\u6790",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"\u6E90\u7801\u4F4D\u7F6E\uFF1Asrc\\core\\observer\\index.js"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export function observe(value: any, asRootData: ?boolean): Observer | void {\n  if (!isObject(value) || value instanceof VNode) {\n    return;\n  }\n  let ob: Observer | void;\n  // \u5224\u65AD\u662F\u5426\u5B58\u5728__ob__\u54CD\u5E94\u5F0F\u5C5E\u6027\n  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {\n    ob = value.__ob__;\n  } else if (\n    shouldObserve &&\n    !isServerRendering() &&\n    (Array.isArray(value) || isPlainObject(value)) &&\n    Object.isExtensible(value) &&\n    !value._isVue\n  ) {\n    // \u5B9E\u4F8B\u5316Observer\u54CD\u5E94\u5F0F\u5BF9\u8C61\n    ob = new Observer(value);\n  }\n  if (asRootData && ob) {\n    ob.vmCount++;\n  }\n  return ob;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Observer"}),"\u7C7B"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export class Observer {\n    value: any;\n    dep: Dep;\n    vmCount: number; // number of vms that have this object as root $data\n\n    constructor (value: any) {\n        this.value = value\n        this.dep = new Dep()\n        this.vmCount = 0\n        def(value, '__ob__', this)\n        if (Array.isArray(value)) {\n            if (hasProto) {\n                protoAugment(value, arrayMethods)\n            } else {\n                copyAugment(value, arrayMethods, arrayKeys)\n            }\n            this.observeArray(value)\n        } else {\n            // \u5B9E\u4F8B\u5316\u5BF9\u8C61\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8FDB\u5165walk\u65B9\u6CD5\n            this.walk(value)\n        }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"walk"}),"\u51FD\u6570"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"walk (obj: Object) {\n    const keys = Object.keys(obj)\n    // \u904D\u5386key\uFF0C\u901A\u8FC7defineReactive\u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61\n    for (let i = 0; i < keys.length; i++) {\n        defineReactive(obj, keys[i])\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"defineReactive"}),"\u65B9\u6CD5"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export function defineReactive(obj: Object, key: string, val: any, customSetter?: ?Function, shallow?: boolean) {\n  const dep = new Dep();\n\n  const property = Object.getOwnPropertyDescriptor(obj, key);\n  if (property && property.configurable === false) {\n    return;\n  }\n\n  // cater for pre-defined getter/setters\n  const getter = property && property.get;\n  const setter = property && property.set;\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key];\n  }\n\n  let childOb = !shallow && observe(val);\n  // \u63A5\u4E0B\u6765\u8C03\u7528Object.defineProperty()\u7ED9\u5BF9\u8C61\u5B9A\u4E49\u54CD\u5E94\u5F0F\u5C5E\u6027\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter() {\n      const value = getter ? getter.call(obj) : val;\n      if (Dep.target) {\n        dep.depend();\n        if (childOb) {\n          childOb.dep.depend();\n          if (Array.isArray(value)) {\n            dependArray(value);\n          }\n        }\n      }\n      return value;\n    },\n    set: function reactiveSetter(newVal) {\n      const value = getter ? getter.call(obj) : val;\n      /* eslint-disable no-self-compare */\n      if (newVal === value || (newVal !== newVal && value !== value)) {\n        return;\n      }\n      /* eslint-enable no-self-compare */\n      if (process.env.NODE_ENV !== 'production' && customSetter) {\n        customSetter();\n      }\n      // #7981: for accessor properties without setter\n      if (getter && !setter) return;\n      if (setter) {\n        setter.call(obj, newVal);\n      } else {\n        val = newVal;\n      }\n      childOb = !shallow && observe(newVal);\n      // \u5BF9\u89C2\u5BDF\u8005watchers\u8FDB\u884C\u901A\u77E5,state\u5C31\u6210\u4E86\u5168\u5C40\u54CD\u5E94\u5F0F\u5BF9\u8C61\n      dep.notify();\n    },\n  });\n}\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"\u53C2\u8003\u6587\u732E",children:["\u53C2\u8003\u6587\u732E",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u53C2\u8003\u6587\u732E",children:"#"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://blog.csdn.net/qq_32682301/article/details/105419673",target:"_blank",rel:"noopener noreferrer",children:"https://blog.csdn.net/qq_32682301/article/details/105419673"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://wbbyouzi.com/archives/343",target:"_blank",rel:"noopener noreferrer",children:"https://wbbyouzi.com/archives/343"})}),"\n"]})]})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}n.default=l,l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["interview%2Fvue%2Fobservable.md"]={toc:[{text:"\u4E00\u3001Observable \u662F\u4EC0\u4E48",id:"\u4E00observable-\u662F\u4EC0\u4E48",depth:2},{text:"\u4E8C\u3001\u4F7F\u7528\u573A\u666F",id:"\u4E8C\u4F7F\u7528\u573A\u666F",depth:2},{text:"\u4E09\u3001\u539F\u7406\u5206\u6790",id:"\u4E09\u539F\u7406\u5206\u6790",depth:2},{text:"\u53C2\u8003\u6587\u732E",id:"\u53C2\u8003\u6587\u732E",depth:2}],title:"Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B",frontmatter:{icon:"question",description:"\u524D\u7AEF\u7269\u8BED|\u9762\u8BD5\u7269\u8BED-Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B",footer:"Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B",order:14,star:14,date:"2023-03-18T00:00:00.000Z",author:"h7ml",image:"https://www.h7ml.cn/logo.png",banner:"https://www.h7ml.cn/logo.png",category:["interview","vue"],tag:["interview","vue"],shortTitle:"\u524D\u7AEF\u7269\u8BED|\u9762\u8BD5\u7269\u8BED-Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B",isOriginal:!1,head:[["meta",{name:"keywords",content:"Vue.observable \u4F60\u6709\u4E86\u89E3\u8FC7\u5417\uFF1F\u8BF4\u8BF4\u770B"}]]}}}}]);