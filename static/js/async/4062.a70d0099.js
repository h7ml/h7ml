/*! For license information please see 4062.a70d0099.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["4062"],{60298:function(e,n,l){"use strict";l.r(n);var s=l("52676"),i=l("40453");function a(e){let n=Object.assign({h2:"h2",a:"a",h3:"h3",p:"p",code:"code",strong:"strong",img:"img",pre:"pre",ul:"ul",li:"li",h5:"h5",div:"div"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h2,{id:"\u5B9E\u73B0-requestidlecallback",children:["\u5B9E\u73B0 requestIdleCallback",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B9E\u73B0-requestidlecallback",children:"#"})]}),"\n",(0,s.jsxs)(n.h3,{id:"\u6D4F\u89C8\u5668\u4E00\u5E27",children:["\u6D4F\u89C8\u5668\u4E00\u5E27",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6D4F\u89C8\u5668\u4E00\u5E27",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5F53\u524D\u5927\u591A\u6570\u7684\u5C4F\u5E55\u5237\u65B0\u7387\u90FD\u662F ",(0,s.jsx)(n.code,{children:"60hz"}),"\uFF0C\u4E5F\u5C31\u662F\u6BCF\u79D2\u5C4F\u5E55\u5237\u65B0 ",(0,s.jsx)(n.code,{children:"60"})," \u6B21\uFF0C\u4F4E\u4E8E ",(0,s.jsx)(n.code,{children:"60hz"})," \u4EBA\u773C\u5C31\u4F1A\u611F\u77E5\u5361\u987F\u6389\u5E27\u7B49\u60C5\u51B5\uFF0C\u540C\u6837\u6211\u4EEC\u524D\u7AEF\u6D4F\u89C8\u5668\u6240\u8BF4\u7684 ",(0,s.jsx)(n.code,{children:"FPS\uFF08frame per second\uFF09"}),"\u662F\u6D4F\u89C8\u5668\u6BCF\u79D2\u5237\u65B0\u7684\u6B21\u6570\uFF0C\u7406\u8BBA\u4E0A ",(0,s.jsx)(n.code,{children:"FPS"})," \u8D8A\u9AD8\u4EBA\u773C\u89C9\u5F97\u754C\u9762\u8D8A\u6D41\u7545\uFF0C\u5728\u4E24\u6B21\u5C4F\u5E55\u786C\u4EF6\u5237\u65B0\u4E4B\u95F4\uFF0C\u6D4F\u89C8\u5668\u6B63\u597D\u8FDB\u884C\u4E00\u6B21\u5237\u65B0\uFF08\u91CD\u7ED8\uFF09\uFF0C\u7F51\u9875\u4E5F\u4F1A\u5F88\u6D41\u7545\uFF0C\u5F53\u7136\u8FD9\u79CD\u662F\u7406\u60F3\u6A21\u5F0F\uFF0C \u5982\u679C\u4E24\u6B21\u786C\u4EF6\u5237\u65B0\u4E4B\u95F4\u6D4F\u89C8\u5668\u91CD\u7ED8\u591A\u6B21\u662F\u6CA1\u610F\u4E49\u7684\uFF0C\u53EA\u4F1A\u6D88\u8017\u8D44\u6E90\uFF0C\u5982\u679C\u6D4F\u89C8\u5668\u91CD\u7ED8\u4E00\u6B21\u7684\u65F6\u95F4\u662F\u786C\u4EF6\u591A\u6B21\u5237\u65B0\u7684\u65F6\u95F4\uFF0C\u90A3\u4E48\u4EBA\u773C\u5C06\u611F\u77E5\u5361\u987F\u6389\u5E27\u7B49\uFF0C \u6240\u4EE5\u6D4F\u89C8\u5668\u5BF9\u4E00\u6B21\u91CD\u7ED8\u7684\u6E32\u67D3\u5DE5\u4F5C\u9700\u8981\u5728 ",(0,s.jsx)(n.code,{children:"16ms\uFF081000ms/60\uFF09"}),"\u4E4B\u5185\u5B8C\u6210\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6BCF\u4E00\u6B21\u91CD\u7ED8\u5C0F\u4E8E 16ms \u624D\u4E0D\u4F1A\u5361\u987F\u6389\u5E27\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6D4F\u89C8\u5668\u7684\u4E00\u5E27\u8BF4\u7684\u5C31\u662F\u4E00\u6B21\u5B8C\u6574\u7684\u91CD\u7ED8\u3002"})}),"\n",(0,s.jsx)(n.p,{children:"\u4E00\u6B21\u91CD\u7ED8\u6D4F\u89C8\u5668\u9700\u8981\u505A\u54EA\u4E9B\u4E8B\u60C5\uFF1F"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/browser-frame.awebp",alt:""})}),"\n",(0,s.jsxs)(n.h3,{id:"\u8BA4\u8BC6-requestidlecallback",children:["\u8BA4\u8BC6 requestIdleCallback",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u8BA4\u8BC6-requestidlecallback",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u6267\u884C\u4F18\u5148\u7EA7\u8F83\u4F4E\u7684\u4EFB\u52A1\u65F6\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"window.requestIdleCallback()"}),"\uFF0C\u610F\u4E3A\u4EA4\u4E88\u4EFB\u52A1\u7ED9\u6D4F\u89C8\u5668\uFF0C\u6D4F\u89C8\u5668\u6709\u7A7A\u95F2\u7684\u65F6\u5019\u6267\u884C\u800C\u4E0D\u662F\u7ACB\u5373\u6267\u884C\u8FD9\u4E9B\u4EFB\u52A1\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u8FD9\u6837\u8FD9\u4E9B\u4F18\u5148\u7EA7\u8F83\u4F4E\u7684\u4EFB\u52A1\u5C31\u4E0D\u963B\u788D\u4E3B\u7EBF\u7A0B\u7684\u4EFB\u52A1\uFF0C\u4EE5\u8FBE\u5230\u6027\u80FD\u4F18\u5316\u7684\u6548\u679C\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/browser-frame2.webp",alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"window.requestIdleCallback(workLoop, { timeout: 50 })\n\n// \u4F18\u5148\u7EA7\u8F83\u4F4E\u7684\u5DE5\u4F5C\nfunction workLoop(deadline) {\n  // \u5982\u679C\u5E27\u5185\u6709\u5BCC\u4F59\u7684\u65F6\u95F4\uFF0C\u6216\u8005\u8D85\u65F6 \u5219\u6267\u884C\u4EFB\u52A1\n  while ((deadline.timeRemaining() > 0 || deadline.didTimeout) && works.length > 0) {\n    // \u6267\u884C\u7684\u51FD\u6570....\n  }\n\n  // \u6709\u672A\u5B8C\u6210\u7684\u4EFB\u52A1 \u5219\u91CD\u65B0\u8C03\u5EA6\n  if (works.length > 0)\n    window.requestIdleCallback(workLoop, { timeout: 50 })\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"callback"}),": \u4E00\u4E2A\u5728\u4E8B\u4EF6\u5FAA\u73AF\u7A7A\u95F2\u65F6\u5373\u5C06\u88AB\u8C03\u7528\u7684\u51FD\u6570\u7684\u5F15\u7528\u3002\u51FD\u6570\u4F1A\u63A5\u6536\u5230\u4E00\u4E2A\u540D\u4E3A ",(0,s.jsx)(n.code,{children:"IdleDeadline"})," \u7684\u53C2\u6570\uFF0C\u8FD9\u4E2A\u53C2\u6570\u53EF\u4EE5\u83B7\u53D6\u5F53\u524D\u7A7A\u95F2\u65F6\u95F4\u4EE5\u53CA\u56DE\u8C03\u662F\u5426\u5728\u8D85\u65F6\u65F6\u95F4\u524D\u5DF2\u7ECF\u6267\u884C\u7684\u72B6\u6001\u3002\u5176\u4E2D ",(0,s.jsx)(n.code,{children:"IdleDeadline"})," \u5BF9\u8C61\u5305\u542B\uFF1A","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"didTimeout"}),"\uFF0C\u5E03\u5C14\u503C\uFF0C\u8868\u793A\u4EFB\u52A1\u662F\u5426\u8D85\u65F6\uFF0C\u7ED3\u5408 ",(0,s.jsx)(n.code,{children:"timeRemaining"})," \u4F7F\u7528\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"timeRemaining()"}),"\uFF0C\u8868\u793A\u5F53\u524D\u5E27\u5269\u4F59\u7684\u65F6\u95F4\uFF0C\u4E5F\u53EF\u7406\u89E3\u4E3A\u7559\u7ED9\u4EFB\u52A1\u7684\u65F6\u95F4\u8FD8\u6709\u591A\u5C11\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"timeout"}),": \u8868\u793A\u8D85\u8FC7\u8FD9\u4E2A\u65F6\u95F4\u540E\uFF0C\u5982\u679C\u4EFB\u52A1\u8FD8\u6CA1\u6267\u884C\uFF0C\u5219\u5F3A\u5236\u6267\u884C\uFF0C\u4E0D\u5FC5\u7B49\u5F85\u7A7A\u95F2\u3002\u5C1A\u672A\u901A\u8FC7\u8D85\u65F6\u6BEB\u79D2\u6570\u8C03\u7528\u56DE\u8C03\uFF0C\u90A3\u4E48\u56DE\u8C03\u4F1A\u5728\u4E0B\u4E00\u6B21\u7A7A\u95F2\u65F6\u671F\u88AB\u5F3A\u5236\u6267\u884C\u3002\u5982\u679C\u660E\u786E\u5728\u67D0\u6BB5\u65F6\u95F4\u5185\u6267\u884C\u56DE\u8C03\uFF0C\u53EF\u4EE5\u8BBE\u7F6E ",(0,s.jsx)(n.code,{children:"timeout"})," ",(0,s.jsx)(n.code,{children:"\u503C\u3002\u5728\u6D4F\u89C8\u5668\u7E41\u5FD9\u7684\u65F6\u5019\uFF0CrequestIdleCallback"})," \u8D85\u65F6\u6267\u884C\u5C31\u548C ",(0,s.jsx)(n.code,{children:"setTimeout"})," \u6548\u679C\u4E00\u6837\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"\u6D4F\u89C8\u5668\u4EC0\u4E48\u65F6\u5019\u6709\u7A7A\u95F2\u65F6\u6BB5",children:["\u6D4F\u89C8\u5668\u4EC0\u4E48\u65F6\u5019\u6709\u7A7A\u95F2\u65F6\u6BB5",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6D4F\u89C8\u5668\u4EC0\u4E48\u65F6\u5019\u6709\u7A7A\u95F2\u65F6\u6BB5",children:"#"})]}),"\n",(0,s.jsxs)(n.h5,{id:"\u573A\u666F\u4E00",children:["\u573A\u666F\u4E00",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u573A\u666F\u4E00",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5F53\u6D4F\u89C8\u5668\u4E00\u5E27\u6E32\u67D3\u6240\u7528\u65F6\u95F4\u5C0F\u4E8E\u5C4F\u5E55\u5237\u65B0\u7387\uFF08\u5BF9\u4E8E\u5177\u6709 60Hz \u7684\u8BBE\u5907\uFF0C\u4E00\u5E27\u95F4\u9694\u5E94\u8BE5\u5C0F\u4E8E 16ms\uFF09\u65F6\u95F4\uFF0C\u5230\u4E0B\u4E00\u5E27\u6E32\u67D3\u6E32\u67D3\u5F00\u59CB\u65F6\u51FA\u73B0\u7684\u7A7A\u95F2\u65F6\u95F4\uFF0C\u5982\u56FE idle period\uFF0C"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/browser-frame2.webp",alt:""})}),"\n",(0,s.jsxs)(n.h5,{id:"\u573A\u666F\u4E8C",children:["\u573A\u666F\u4E8C",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u573A\u666F\u4E8C",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5F53\u6D4F\u89C8\u5668\u6CA1\u6709\u53EF\u6E32\u67D3\u7684\u4EFB\u52A1\uFF0C\u4E3B\u7EBF\u7A0B\u4E00\u76F4\u5904\u4E8E\u7A7A\u95F2\u72B6\u6001\uFF0C\u4E8B\u4EF6\u961F\u5217\u4E3A\u7A7A\u3002\u4E3A\u4E86\u907F\u514D\u5728\u4E0D\u53EF\u9884\u6D4B\u7684\u4EFB\u52A1\uFF08\u4F8B\u5982\u7528\u6237\u8F93\u5165\u7684\u5904\u7406\uFF09\u4E2D\u5F15\u8D77\u7528\u6237\u53EF\u5BDF\u89C9\u7684\u5EF6\u8FDF\uFF0C\u8FD9\u4E9B\u7A7A\u95F2\u5468\u671F\u7684\u957F\u5EA6\u5E94\u9650\u5236\u4E3A\u6700\u5927\u503C ",(0,s.jsx)(n.code,{children:"50ms"}),"\uFF0C\u4E5F\u5C31\u662F ",(0,s.jsx)(n.code,{children:"timeRemaining"})," \u6700\u5927\u4E0D\u8D85\u8FC7 50\uFF08\u4E5F\u5C31\u662F 20fps\uFF0C\u8FD9\u4E5F\u662F ",(0,s.jsx)(n.code,{children:"react polyfill"})," \u7684\u539F\u56E0\u4E4B\u4E00\uFF09\uFF0C\u5F53\u7A7A\u95F2\u65F6\u6BB5\u7ED3\u675F\u65F6\uFF0C\u53EF\u4EE5\u8C03\u5EA6\u53E6\u4E00\u4E2A\u7A7A\u95F2\u65F6\u6BB5\uFF0C\u5982\u679C\u5B83\u4FDD\u6301\u7A7A\u95F2\uFF0C\u90A3\u4E48\u7A7A\u95F2\u65F6\u6BB5\u5C06\u66F4\u957F\uFF0C\u540E\u53F0\u4EFB\u52A1\u53EF\u4EE5\u5728\u66F4\u957F\u65F6\u95F4\u6BB5\u5185\u53D1\u751F\u3002\u5982\u56FE:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/browser-frame3.awebp",alt:""})}),"\n",(0,s.jsxs)(n.h3,{id:"react-\u5982\u4F55\u5B9E\u73B0-requestidlecallback",children:["react \u5982\u4F55\u5B9E\u73B0 requestIdleCallback",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#react-\u5982\u4F55\u5B9E\u73B0-requestidlecallback",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u524D\u9762\u63D0\u5230 ",(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u5DE5\u4F5C\u53EA\u6709 ",(0,s.jsx)(n.code,{children:"20FPS"}),"\uFF0C\u4E00\u822C\u5BF9\u7528\u6237\u6765\u611F\u89C9\u6765\u8BF4\uFF0C\u9700\u8981\u5230 ",(0,s.jsx)(n.code,{children:"60FPS"})," \u624D\u662F\u6D41\u7545\u7684, \u5373\u4E00\u5E27\u65F6\u95F4\u4E3A ",(0,s.jsx)(n.code,{children:"16.7 ms"}),"\uFF0C\u6240\u4EE5\u8FD9\u4E5F\u662F react \u56E2\u961F\u81EA\u5DF1\u5B9E\u73B0 ",(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u7684\u539F\u56E0\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5B9E\u73B0\u5927\u81F4\u601D\u8DEF\u662F\u5728 requestAnimationFrame \u83B7\u53D6\u4E00\u6862\u7684\u5F00\u59CB\u65F6\u95F4\uFF0C\u89E6\u53D1\u4E00\u4E2A postMessage\uFF0C\u5728\u7A7A\u95F2\u7684\u65F6\u5019\u8C03\u7528 idleTick \u6765\u5B8C\u6210\u5F02\u6B65\u4EFB\u52A1\u3002"})}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive :",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"tabs"}),(0,s.jsxs)(n.div,{className:"rspress-directive-content",children:["\n",(0,s.jsx)(n.p,{children:"::: tab React polyfill"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"export let requestHostCallback // \u7C7B\u4F3CrequestIdleCallback\nexport let cancelHostCallback // \u7C7B\u4F3CcancelIdleCallback\nexport let requestHostTimeout // \u975Edom\u73AF\u5883\u7684\u5B9E\u73B0\nexport let cancelHostTimeout // \u53D6\u6D88requestHostTimeout\nexport let shouldYieldToHost // \u5224\u65AD\u4EFB\u52A1\u662F\u5426\u8D85\u65F6,\u9700\u8981\u88AB\u6253\u65AD\nexport let requestPaint //\nexport let getCurrentTime // \u83B7\u53D6\u5F53\u524D\u65F6\u95F4\nexport let forceFrameRate // \u6839\u636Efps\u8BA1\u7B97\u5E27\u65F6\u95F4\n// \u975Edom\u73AF\u5883\nif (typeof window === 'undefined' || typeof MessageChannel !== 'function') {\n  let _callback = null // \u6B63\u5728\u6267\u884C\u7684\u56DE\u8C03\n  let _timeoutID = null\n  const _flushCallback = function () {\n    // \u5982\u679C\u56DE\u8C03\u5B58\u5728\u5219\u6267\u884C\uFF0C\n    if (_callback !== null) {\n      try {\n        const currentTime = getCurrentTime()\n        const hasRemainingTime = true\n        // hasRemainingTime \u7C7B\u4F3Cdeadline.didTimeout\n        _callback(hasRemainingTime, currentTime)\n        _callback = null\n      }\n      catch (e) {\n        setTimeout(_flushCallback, 0)\n        throw e\n      }\n    }\n  }\n\n  // ...\n\n  requestHostCallback = function (cb) {\n    // \u82E5_callback\u5B58\u5728\uFF0C\u8868\u793A\u5F53\u4E0B\u6709\u4EFB\u52A1\u518D\u7EE7\u7EED\uFF0C\n    if (_callback !== null) {\n      // setTimeout\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570\u53EF\u4EE5\u5EF6\u540E\u6267\u884C\u4EFB\u52A1\u3002\n      setTimeout(requestHostCallback, 0, cb)\n    }\n    else {\n      // \u5426\u5219\u76F4\u63A5\u6267\u884C\u3002\n      _callback = cb\n      setTimeout(_flushCallback, 0)\n    }\n  }\n  cancelHostCallback = function () {\n    _callback = null\n  }\n  requestHostTimeout = function (cb, ms) {\n    _timeoutID = setTimeout(cb, ms)\n  }\n  cancelHostTimeout = function () {\n    clearTimeout(_timeoutID)\n  }\n  shouldYieldToHost = function () {\n    return false\n  }\n  requestPaint = forceFrameRate = function () {}\n}\nelse {\n  // \u4E00\u5927\u5806\u7684\u6D4F\u89C8\u5668\u65B9\u6CD5\u7684\u5224\u65AD\uFF0C\u6709performance\uFF0C requestAnimationFrame\uFF0C cancelAnimationFrame\n  // ...\n  const performWorkUntilDeadline = () => {\n    if (scheduledHostCallback !== null) {\n      const currentTime = getCurrentTime()\n      // yieldInterval\u6BCF\u5E27\u7684\u65F6\u95F4\uFF0Cdeadline\u4E3A\u6700\u7EC8\u671F\u9650\u65F6\u95F4\n      deadline = currentTime + yieldInterval\n      const hasTimeRemaining = true\n      try {\n        const hasMoreWork = scheduledHostCallback(hasTimeRemaining, currentTime)\n        if (!hasMoreWork) {\n          isMessageLoopRunning = false\n          scheduledHostCallback = null\n        }\n        else {\n          // \u5982\u679C\u6709\u66F4\u591A\u7684\u5DE5\u4F5C\uFF0C\u5C31\u628A\u4E0B\u4E00\u4E2A\u6D88\u606F\u4E8B\u4EF6\u5B89\u6392\u5728\u524D\u4E00\u4E2A\u6D88\u606F\u4E8B\u4EF6\u7684\u6700\u540E\n          port.postMessage(null)\n        }\n      }\n      catch (error) {\n        // \u5982\u679C\u8C03\u5EA6\u4EFB\u52A1\u629B\u51FA\uFF0C\u5219\u9000\u51FA\u5F53\u524D\u6D4F\u89C8\u5668\u4EFB\u52A1\uFF0C\u4EE5\u4FBF\u89C2\u5BDF\u9519\u8BEF\u3002\n        port.postMessage(null)\n        throw error\n      }\n    }\n    else {\n      isMessageLoopRunning = false\n    }\n    needsPaint = false\n  }\n\n  const channel = new MessageChannel()\n  const port = channel.port2\n  channel.port1.onmessage = performWorkUntilDeadline\n\n  requestHostCallback = function (callback) {\n    scheduledHostCallback = callback\n    if (!isMessageLoopRunning) {\n      isMessageLoopRunning = true\n      port.postMessage(null)\n    }\n  }\n}\n"})}),"\n"]})]}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive tab",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"\u81EA\u5DF1\u5B9E\u73B0\u4E00\u7248"}),(0,s.jsxs)(n.div,{className:"rspress-directive-content",children:["\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"class RequestIdle {\n  deadlineTime = null\n  callback = () => {}\n  channel = null\n  port1 = null\n  port2 = null\n  isWaitingAvailableFrame = true\n\n  constructor() {\n    this.channel = new MessageChannel()\n    this.port1 = this.channel.port1\n    this.port2 = this.channel.port2\n    this.port2.onmessage = () => {\n      const timeRemaining = () => this.deadlineTime - performance.now()\n      const _timeRemain = timeRemaining()\n      if (_timeRemain > 0 && this.callback && this.isWaitingAvailableFrame) {\n        const deadline = {\n          timeRemaining,\n          didTimeout: _timeRemain < 0,\n        }\n        this.callback(deadline)\n        this.isWaitingAvailableFrame = false\n      }\n      else if (this.isWaitingAvailableFrame) {\n        this.RequestIdleCallback(this.callback)\n      }\n    }\n  }\n\n  RequestIdleCallback = function (cb) {\n    const SECONDE_DURATION = 1000\n    const FRAME_DURATION = SECONDE_DURATION / 60\n    this.callback = cb\n    this.isWaitingAvailableFrame = true\n    if (!document.hidden) {\n      requestAnimationFrame((rafTime) => {\n        this.deadlineTime = rafTime + FRAME_DURATION\n        this.port1.postMessage(null)\n      })\n    }\n    else {\n      this.deadlineTime = performance.now() + SECONDE_DURATION\n      this.port1.postMessage(null)\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8C03\u7528\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const idle = new RequestIdle()\n\nidle.RequestIdleCallback(workLoop)\n\nfunction workLoop(deadline) {\n  console.log(`\u672C\u5E27\u5269\u4F59\u65F6\u95F4 ${Number.parseInt(deadline.timeRemaining())}`)\n\n  // \u5982\u679C\u5E27\u5185\u6709\u5BCC\u4F59\u7684\u65F6\u95F4\uFF0C\u6216\u8005\u8D85\u65F6 \u5219\u6267\u884C\u4EFB\u52A1\n  while ((deadline.timeRemaining() > 0 || deadline.didTimeout) && works.length > 0)\n    console.log(33)\n\n  // \u6709\u672A\u5B8C\u6210\u7684\u4EFB\u52A1 \u5219\u91CD\u65B0\u8C03\u5EA6\n  if (works.length > 0)\n    idle.RequestIdleCallback(workLoop)\n}\n\nfunction sleep(delay) {\n  for (let start = Date.now(); Date.now() - start <= delay;) {\n    // ...\n  }\n}\n\nconst works = [\n  () => {\n    console.log('\u7B2C\u4E00\u4E2A\u4EFB\u52A1\u5F00\u59CB')\n    sleep(20)\n    console.log('\u7B2C\u4E00\u4E2A\u4EFB\u52A1\u7ED3\u675F')\n  },\n  () => {\n    console.log('\u7B2C\u4E8C\u4E2A\u4EFB\u52A1\u5F00\u59CB')\n    sleep(20)\n    console.log('\u7B2C\u4E8C\u4E2A\u4EFB\u52A1\u7ED3\u675F')\n  },\n  () => {\n    console.log('\u7B2C\u4E09\u4E2A\u4EFB\u52A1\u5F00\u59CB')\n    sleep(20)\n    console.log('\u7B2C\u4E09\u4E2A\u4EFB\u52A1\u7ED3\u675F')\n  },\n]\n"})}),"\n"]})]}),"\n",(0,s.jsx)(n.p,{children:"::::"}),"\n",(0,s.jsxs)(n.h3,{id:"\u603B\u7ED3",children:["\u603B\u7ED3",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u603B\u7ED3",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u9700\u8981\u6CE8\u610F\u7684\uFF1A"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u662F\u5C4F\u5E55\u6E32\u67D3\u4E4B\u540E\u6267\u884C\u7684\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4E00\u4E9B\u4F4E\u4F18\u5148\u7EA7\u7684\u4EFB\u52A1\u53EF\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u7B49\u6D4F\u89C8\u5668\u4E0D\u5FD9\u7684\u65F6\u5019\u6765\u6267\u884C\uFF0C\u540C\u65F6\u56E0\u4E3A\u65F6\u95F4\u6709\u9650\uFF0C\u5B83\u6240\u6267\u884C\u7684\u4EFB\u52A1\u5E94\u8BE5\u5C3D\u91CF\u662F\u80FD\u591F\u91CF\u5316\uFF0C\u7EC6\u5206\u7684\u5FAE\u4EFB\u52A1\uFF08micro task\uFF09\u6BD4\u8F83\u9002\u5408 ",(0,s.jsx)(n.code,{children:"requestIdleCallback"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u4E0D\u4F1A\u548C\u5E27\u5BF9\u9F50\uFF0C\u6240\u4EE5\u6D89\u53CA\u5230 DOM \u7684\u64CD\u4F5C\u548C\u52A8\u753B\u6700\u597D\u653E\u5728 ",(0,s.jsx)(n.code,{children:"requestAnimationFrame"})," \u4E2D\u6267\u884C\uFF0C",(0,s.jsx)(n.code,{children:"requestAnimationFrame"})," \u5728\u91CD\u65B0\u6E32\u67D3\u5C4F\u5E55\u4E4B\u524D\u6267\u884C\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Promise"})," \u4E5F\u4E0D\u5EFA\u8BAE\u5728\u8FD9\u91CC\u9762\u8FDB\u884C\uFF0C\u56E0\u4E3A ",(0,s.jsx)(n.code,{children:"Promise"})," \u7684\u56DE\u8C03\u5C5E\u6027 ",(0,s.jsx)(n.code,{children:"Event loop"})," \u4E2D\u4F18\u5148\u7EA7\u8F83\u9AD8\u7684\u4E00\u79CD\u5FAE\u4EFB\u52A1\uFF0C\u4F1A\u5728 ",(0,s.jsx)(n.code,{children:"requestIdleCallback"})," \u7ED3\u675F\u65F6\u7ACB\u5373\u6267\u884C\uFF0C\u4E0D\u7BA1\u6B64\u65F6\u662F\u5426\u8FD8\u6709\u5BCC\u4F59\u7684\u65F6\u95F4\uFF0C\u8FD9\u6837\u6709\u5F88\u5927\u53EF\u80FD\u4F1A\u8BA9\u4E00\u5E27\u8D85\u8FC7 16 ms\u3002"]}),"\n"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}n.default=c,c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["posts%2Freact%2FrequestIdleCallback.md"]={toc:[{text:"\u5B9E\u73B0 requestIdleCallback",id:"\u5B9E\u73B0-requestidlecallback",depth:2},{text:"\u6D4F\u89C8\u5668\u4E00\u5E27",id:"\u6D4F\u89C8\u5668\u4E00\u5E27",depth:3},{text:"\u8BA4\u8BC6 requestIdleCallback",id:"\u8BA4\u8BC6-requestidlecallback",depth:3},{text:"\u6D4F\u89C8\u5668\u4EC0\u4E48\u65F6\u5019\u6709\u7A7A\u95F2\u65F6\u6BB5",id:"\u6D4F\u89C8\u5668\u4EC0\u4E48\u65F6\u5019\u6709\u7A7A\u95F2\u65F6\u6BB5",depth:3},{text:"react \u5982\u4F55\u5B9E\u73B0 requestIdleCallback",id:"react-\u5982\u4F55\u5B9E\u73B0-requestidlecallback",depth:3},{text:"\u603B\u7ED3",id:"\u603B\u7ED3",depth:3}],title:"requestIdleCallback",frontmatter:{icon:"react",order:4,date:"2021-07-12T00:00:00.000Z",author:"h7ml",title:"requestIdleCallback",category:"react",tag:["react","requestIdleCallback"],star:!0,lastUpdated:!1}}}}]);