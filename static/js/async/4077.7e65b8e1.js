/*! For license information please see 4077.7e65b8e1.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["4077"],{52279:function(e,n,t){"use strict";t.r(n);var s=t("52676"),c=t("40453");function a(e){let n=Object.assign({h2:"h2",a:"a",pre:"pre",code:"code",p:"p",h3:"h3",img:"img",strong:"strong",ol:"ol",li:"li"},(0,c.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h2,{id:"setstate-\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u7684",children:["setState \u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u7684\uFF1F",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#setstate-\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u7684",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"trigger = (isBatchedUpdate: boolean) => {\n  const runSetState = () => {\n    this.setState({ count: this.state.count + 1 }, () => console.log(this.state.count));\n  };\n\n  if (isBatchedUpdate) {\n    runSetState();\n  } else {\n    setTimeout(runSetState, 0);\n  }\n};\n\n<button onClick={() => this.trigger(true)}>\u89E6\u53D1\u5408\u6210\u4E8B\u4EF6</button>;\n<button onClick={() => this.trigger(false)}>\u89E6\u53D1 setTimeout \u4E8B\u4EF6</button>;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53EF\u4EE5\u53D1\u73B0\u4E24\u4E2A\u6267\u884C\u7684\u65F6\u673A\u4E0D\u4E00\u6837\uFF0C",(0,s.jsx)(n.code,{children:"console.log"})," \u7684\u7ED3\u679C\u4E5F\u4E0D\u4E00\u6837\u3002\u4E00\u4E2A\u662F\u540C\u6B65\uFF0C\u4E00\u4E2A\u5219\u662F\u5F02\u6B65\u3002"]}),"\n",(0,s.jsxs)(n.h3,{id:"\u5206\u6790",children:["\u5206\u6790",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5206\u6790",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4EEC\u6765\u770B\u770B react \u90E8\u5206\u6E90\u7801"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function scheduleUpdateOnFiber(fiber, lane, eventTime) {\n  if (lane === SyncLane) {\n    // \u540C\u6B65\u64CD\u4F5C\n    ensureRootIsScheduled(root, eventTime)\n    // \u5224\u65AD\u5F53\u524D\u662F\u5426\u8FD8\u5728 React \u4E8B\u4EF6\u6D41\u4E2D\n    // \u5982\u679C\u4E0D\u5728\uFF0C\u76F4\u63A5\u8C03\u7528 flushSyncCallbackQueue \u66F4\u65B0\n    if (executionContext === NoContext)\n      flushSyncCallbackQueue()\n  }\n  else {\n    // \u5F02\u6B65\u64CD\u4F5C\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4E0A\u8FF0\u4EE3\u7801\u53EF\u4EE5\u7B80\u5355\u63CF\u8FF0\u8FD9\u4E2A\u8FC7\u7A0B\uFF0C\u4E3B\u8981\u662F\u5224\u65AD\u4E86 ",(0,s.jsx)(n.code,{children:"executionContext"})," \u662F\u5426\u7B49\u4E8E ",(0,s.jsx)(n.code,{children:"NoContext"})," \u6765\u786E\u5B9A\u5F53\u524D\u66F4\u65B0\u6D41\u7A0B\u662F\u5426\u5728 React \u4E8B\u4EF6\u6D41\u4E2D\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u6709\u7684\u4E8B\u4EF6\u5728\u89E6\u53D1\u7684\u65F6\u5019\uFF0C\u90FD\u4F1A\u5148\u8C03\u7528 ",(0,s.jsx)(n.code,{children:"batchedEventUpdates$1"})," \u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u5728\u8FD9\u91CC\u5C31\u4F1A\u4FEE\u6539 ",(0,s.jsx)(n.code,{children:"executionContext"})," \u7684\u503C\uFF0CReact \u5C31\u77E5\u9053\u6B64\u65F6\u7684 ",(0,s.jsx)(n.code,{children:"setState"})," \u5728\u81EA\u5DF1\u7684\u638C\u63A7\u4E2D\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// executionContext \u7684\u9ED8\u8BA4\u72B6\u6001\nlet executionContext = NoContext\nfunction batchedEventUpdates$1(fn, a) {\n  const prevExecutionContext = executionContext\n  executionContext |= EventContext // \u4FEE\u6539\u72B6\u6001\n  try {\n    return fn(a)\n  }\n  finally {\n    executionContext = prevExecutionContext\n    // \u8C03\u7528\u7ED3\u675F\u540E\uFF0C\u8C03\u7528 flushSyncCallbackQueue\n    if (executionContext === NoContext)\n      flushSyncCallbackQueue()\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/setState.png",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u6240\u4EE5\uFF0C\u4E0D\u7BA1\u662F\u76F4\u63A5\u8C03\u7528 flushSyncCallbackQueue \uFF0C\u8FD8\u662F\u63A8\u8FDF\u8C03\u7528\uFF0C\u8FD9\u91CC\u672C\u8D28\u4E0A\u90FD\u662F\u540C\u6B65\u7684\uFF0C\u53EA\u662F\u6709\u4E2A\u5148\u540E\u987A\u5E8F\u7684\u95EE\u9898\u3002"}),"\n",(0,s.jsxs)(n.h3,{id:"\u7ED3\u8BBA",children:["\u7ED3\u8BBA",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u7ED3\u8BBA",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u540C\u6B65\u60C5\u51B5"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5F53\u524D\u662F ",(0,s.jsx)(n.code,{children:"Legacy \u6A21\u5F0F"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u5728\u975E\u5408\u6210\u4E8B\u4EF6\u4E2D\u6267\u884C ",(0,s.jsx)(n.code,{children:"setState"}),"\uFF0C\u6BD4\u5982 ",(0,s.jsx)(n.code,{children:"setTimeout"}),", ",(0,s.jsx)(n.code,{children:"Promise"}),", ",(0,s.jsx)(n.code,{children:"MessageChannel"})," \u7B49"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5F02\u6B65\u60C5\u51B5"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5982\u679C\u662F\u5408\u6210\u4E8B\u4EF6\u4E2D\u7684\u56DE\u8C03, ",(0,s.jsx)(n.code,{children:"executionContext |= EventContext"}),", \u6240\u4EE5\u4E0D\u4F1A\u8FDB\u5165, \u6700\u7EC8\u8868\u73B0\u51FA\u5F02\u6B65"]}),"\n",(0,s.jsx)(n.li,{children:"concurrent \u6A21\u5F0F\u4E0B\u90FD\u4E3A\u5F02\u6B65"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"\u6279\u5904\u7406",children:["\u6279\u5904\u7406",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6279\u5904\u7406",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.strong,{children:"React \u5408\u6210\u4E8B\u4EF6"}),"\u4E2D\u6267\u884C\u591A\u6B21 setState \u540E\uFF0Creact \u4F1A\u5408\u5E76\u8FDB\u884C\u4E00\u6B21\u66F4\u65B0\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u63D0\u9AD8\u6027\u80FD\uFF0C\u8FD9\u5C31\u662F",(0,s.jsx)(n.strong,{children:"\u6279\u5904\u7406"}),"\u7684\u6982\u5FF5\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"trigger = (isBatchedUpdate: boolean) => {\n  const runSetState = () => {\n    this.setState({ count: this.state.count + 1 });\n    this.setState({ age: this.state.age + 1 });\n  };\n\n  if (isBatchedUpdate) {\n    runSetState(); // render \u4E00\u6B21\n  } else {\n    setTimeout(runSetState, 0); // render \u4E24\u6B21\n  }\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5373\u4F7F\u662F async \u51FD\u6570\uFF0CisBatchedUpdate \u4E3A false\uFF0C\u90A3\u591A\u6B21 setState \u5B9E\u9645\u4E0A\u4E5F\u4F1A render \u591A\u6B21\u3002\uFF5E\uFF5E"}),"\n",(0,s.jsxs)(n.h3,{id:"\u7ED9\u5F20\u56FE",children:["\u7ED9\u5F20\u56FE",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u7ED9\u5F20\u56FE",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://alvin-cdn.oss-cn-shenzhen.aliyuncs.com/images/setState-async.png",alt:""})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}n.default=i,i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["posts%2Freact%2FsetState.md"]={toc:[{text:"setState \u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u7684\uFF1F",id:"setstate-\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u7684",depth:2},{text:"\u5206\u6790",id:"\u5206\u6790",depth:3},{text:"\u7ED3\u8BBA",id:"\u7ED3\u8BBA",depth:3},{text:"\u6279\u5904\u7406",id:"\u6279\u5904\u7406",depth:3},{text:"\u7ED9\u5F20\u56FE",id:"\u7ED9\u5F20\u56FE",depth:3}],title:"setState",frontmatter:{icon:"react",order:5,date:"2021-07-12T00:00:00.000Z",author:"h7ml",title:"setState",category:"react",tag:["react","setState"],star:!0,lastUpdated:!1}}}}]);