/*! For license information please see 93290.34475cf2.js.LICENSE.txt */
(self.webpackChunkh7ml=self.webpackChunkh7ml||[]).push([["93290"],{78210:function(e,n,r){"use strict";r.r(n);var t=r("52676"),i=r("40453");function s(e){let n=Object.assign({h2:"h2",a:"a",ul:"ul",li:"li",h3:"h3",pre:"pre",code:"code",p:"p",ol:"ol"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h2,{id:"react-immer-\u4E0D\u53EF\u53D8\u6570\u636E",children:["react immer \u4E0D\u53EF\u53D8\u6570\u636E",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#react-immer-\u4E0D\u53EF\u53D8\u6570\u636E",children:"#"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://es6.ruanyifeng.com/#docs/proxy",target:"_blank",rel:"noopener noreferrer",children:"\u962E\u4E00\u5CF0 ECMAScript 6 \u5165\u95E8"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://juejin.cn/post/6857319959774265358",target:"_blank",rel:"noopener noreferrer",children:"\u5E26\u4F60\u91CD\u5B66 ES6 | proxy"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://juejin.cn/post/6859162309449744391",target:"_blank",rel:"noopener noreferrer",children:"\u5E26\u4F60\u91CD\u5B66 ES6 | Reflect"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://juejin.cn/post/6844903601416978439",target:"_blank",rel:"noopener noreferrer",children:"\u5B9E\u73B0\u53CC\u5411\u7ED1\u5B9A Proxy \u6BD4 defineproperty \u4F18\u52A3\u5982\u4F55?"})}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"\u4E3A\u4EC0\u4E48\u5F3A\u8C03\u4E0D\u53EF\u53D8\u6570\u636E",children:["\u4E3A\u4EC0\u4E48\u5F3A\u8C03\u4E0D\u53EF\u53D8\u6570\u636E",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E3A\u4EC0\u4E48\u5F3A\u8C03\u4E0D\u53EF\u53D8\u6570\u636E",children:"#"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import React from 'react'\n\nexport default () => {\n  const [obj, setObj] = useState({ name: 'alvin', others: { age: 18 } })\n  const [count, setCount] = useState(0)\n\n  const hanleClick = () => {\n    obj.others.age = 99\n    setCount(prev => prev + 1)\n  }\n\n  return (\n    <>\n      <button onClick={hanleClick}>click</button>\n      {JSON.stringify(obj, null, 2)}\n    </>\n  )\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u4E0A\uFF0C\u70B9\u51FB\u540E\u5C31\u4F1A\u53D1\u73B0 obj \u5F15\u7528\u6CA1\u53D8\uFF0C\u4F46\u662F ",(0,t.jsx)(n.code,{children:"obj.others.age"})," \u4FEE\u6539\u4E86\uFF0C\u7136\u540E\u4E5F\u88AB\u91CD\u65B0\u6E32\u67D3\u4E86\uFF0C\u8FD9\u662F\u7531\u4E8E\u8FD9\u5C31\u662F\u5F15\u7528\u7C7B\u578B\u7684\u526F\u4F5C\u7528\u5BFC\u81F4\u7684\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u89E3\u51B3\u65B9\u6848"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u6D45\u590D\u5236\uFF1A\u53EA\u80FD\u590D\u5236\u4E00\u5C42"}),"\n",(0,t.jsx)(n.li,{children:"\u6DF1\u514B\u9686\uFF1A\u6211\u4EEC\u4E0D\u4EC5\u8981\u8003\u8651\u5230\u6B63\u5219\u3001Symbol\u3001Date \u7B49\u7279\u6B8A\u7C7B\u578B,\u8FD8\u8981\u8003\u8651\u5230\u539F\u578B\u94FE\u548C\u5FAA\u73AF\u5F15\u7528\u7684\u5904\u7406\uFF0C\u6027\u80FD\u6D88\u8017\u5927\uFF01"}),"\n",(0,t.jsxs)(n.li,{children:["\u6DF1\u514B\u9686\u7684\u7684\u6027\u80FD\u76F8\u6BD4\u4E8E\u6D45\u514B\u9686\u5927\u6253\u6298\u6263,\u4F46\u662F\u6D45\u514B\u9686\u53C8\u4E0D\u80FD\u4ECE\u6839\u672C\u4E0A\u675C\u7EDD\u5F15\u7528\u7C7B\u578B\u7684\u526F\u4F5C\u7528\uFF0C\u4F7F\u7528 immutable\uFF1A","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5373\u5982\u679C\u5BF9\u8C61\u6811\u4E2D\u4E00\u4E2A\u8282\u70B9\u53D1\u751F\u53D8\u5316\uFF0C\u53EA\u4FEE\u6539\u8FD9\u4E2A\u8282\u70B9\u548C\u53D7\u5B83\u5F71\u54CD\u7684\u7236\u8282\u70B9\uFF0C\u5176\u5B83\u8282\u70B9\u5219\u8FDB\u884C\u5171\u4EAB\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"\u5B9E\u73B0\u7B80\u5355\u7684-immutable",children:["\u5B9E\u73B0\u7B80\u5355\u7684 immutable",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B9E\u73B0\u7B80\u5355\u7684-immutable",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"immer"})," \u7528\u6CD5\u4E3E\u4F8B\uFF1A ",(0,t.jsx)(n.code,{children:"const nextState = produce(state, (draft) => {});"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"/** \u6D45\u590D\u5236 */\nfunction shallowCopy(value) {\n  if (Array.isArray(value))\n    return value.slice()\n  if (value.__proto__ === undefined)\n    return Object.assign(Object.create(null), value)\n  return Object.assign({}, value)\n}\n\nfunction createState(target) {\n  this.modified = false // \u662F\u5426\u88AB\u4FEE\u6539\n  this.target = target // \u76EE\u6807\u5BF9\u8C61\n  this.copy = undefined // \u62F7\u8D1D\u7684\u5BF9\u8C61\n}\n\ncreateState.prototype = {\n  // \u5BF9\u4E8Eget\u64CD\u4F5C,\u5982\u679C\u76EE\u6807\u5BF9\u8C61\u6CA1\u6709\u88AB\u4FEE\u6539\u76F4\u63A5\u8FD4\u56DE\u539F\u5BF9\u8C61,\u5426\u5219\u8FD4\u56DE\u62F7\u8D1D\u5BF9\u8C61\n  get(key) {\n    if (!this.modified)\n      return this.target[key]\n    return this.copy[key]\n  },\n\n  // \u5BF9\u4E8Eset\u64CD\u4F5C,\u5982\u679C\u76EE\u6807\u5BF9\u8C61\u6CA1\u88AB\u4FEE\u6539\u90A3\u4E48\u8FDB\u884C\u4FEE\u6539\u64CD\u4F5C,\u5426\u5219\u4FEE\u6539\u62F7\u8D1D\u5BF9\u8C61\n  set(key, value) {\n    if (!this.modified)\n      this.markChanged()\n    return (this.copy[key] = value)\n  },\n\n  // \u6807\u8BB0\u72B6\u6001\u4E3A\u5DF2\u4FEE\u6539,\u5E76\u62F7\u8D1D\n  markChanged() {\n    if (!this.modified) {\n      this.modified = true\n      this.copy = shallowCopy(this.target)\n    }\n  },\n}\n\nconst PROXY_STATE = Symbol('proxy-state')\n\n// \u63A5\u53D7\u4E00\u4E2A\u76EE\u6807\u5BF9\u8C61\u548C\u4E00\u4E2A\u64CD\u4F5C\u76EE\u6807\u5BF9\u8C61\u7684\u51FD\u6570\nfunction produce(state, producer) {\n  const store = new createState(state)\n  const proxy = new Proxy(store, {\n    get(target, key) {\n      if (key === PROXY_STATE)\n        return target\n      return target.get(key)\n    },\n    set(target, key, value) {\n      return target.set(key, value)\n    },\n  })\n\n  producer(proxy)\n\n  const newState = proxy[PROXY_STATE]\n  if (newState.modified)\n    return newState.copy\n  return newState.target\n}\n\nconst baseState = [\n  { todo: 'Learn typescript', done: true },\n  { todo: 'Try immer', done: false },\n]\n\nconst nextState = produce(baseState, (draft) => {\n  draft.push({ todo: 'Tweet about it', done: false })\n  draft[1].done = true // \u8FD9\u91CC\u4F1A\u6539\u5230\u539F\u5C5E\u6027\n})\n\nconsole.log(baseState, nextState)\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6267\u884C\u7ED3\u679C\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"[\n  { todo: 'Learn typescript', done: true },\n  { todo: 'Try immer', done: true },\n][\n  ({ todo: 'Learn typescript', done: true }, { todo: 'Try immer', done: true }, { todo: 'Tweet about it', done: false })\n]\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"defineproperty-vs-proxy",children:["defineProperty vs Proxy",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#defineproperty-vs-proxy",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"\u8FD9\u4E2A\u6CA1\u7279\u522B\u7684\u6DF1\u5165\uFF0C"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"defineProperty"})," \u65E0\u6CD5\u76D1\u542C\u6570\u7EC4\u53D8\u5316 \u6BD4\u5982 ",(0,t.jsx)(n.code,{children:"arr[1] = 2"}),"; \u5982\u679C\u9700\u8981\u76D1\u542C"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"defineProperty"})," \u53EA\u80FD\u52AB\u6301\u5BF9\u8C61\u7684\u5C5E\u6027,\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u5BF9\u6BCF\u4E2A\u5BF9\u8C61\u7684\u6BCF\u4E2A\u5C5E\u6027\u8FDB\u884C\u904D\u5386\uFF0C\u5982\u679C\u5C5E\u6027\u503C\u4E5F\u662F\u5BF9\u8C61\u90A3\u4E48\u9700\u8981\u6DF1\u5EA6\u904D\u5386,\u663E\u7136\u80FD\u52AB\u6301\u4E00\u4E2A\u5B8C\u6574\u7684\u5BF9\u8C61\u662F\u66F4\u597D\u7684\u9009\u62E9\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Proxy"})," \u53EF\u4EE5\u76F4\u63A5\u76D1\u542C\u5BF9\u8C61\u800C\u975E\u5C5E\u6027,",(0,t.jsx)(n.code,{children:"Proxy"})," \u7684\u52A3\u52BF\u5C31\u662F\u517C\u5BB9\u6027\u95EE\u9898,\u800C\u4E14\u65E0\u6CD5\u7528 ",(0,t.jsx)(n.code,{children:"polyfill"})," \u78E8\u5E73"]}),"\n"]})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(s,{...e})}):s(e)}n.default=a,a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["posts%2Freact%2Fimmer.md"]={toc:[{text:"react immer \u4E0D\u53EF\u53D8\u6570\u636E",id:"react-immer-\u4E0D\u53EF\u53D8\u6570\u636E",depth:2},{text:"\u4E3A\u4EC0\u4E48\u5F3A\u8C03\u4E0D\u53EF\u53D8\u6570\u636E",id:"\u4E3A\u4EC0\u4E48\u5F3A\u8C03\u4E0D\u53EF\u53D8\u6570\u636E",depth:3},{text:"\u5B9E\u73B0\u7B80\u5355\u7684 immutable",id:"\u5B9E\u73B0\u7B80\u5355\u7684-immutable",depth:3},{text:"defineProperty vs Proxy",id:"defineproperty-vs-proxy",depth:3}],title:"immer",frontmatter:{icon:"react",order:3,date:"2021-07-12T00:00:00.000Z",author:"h7ml",title:"immer",category:"react",tag:["react","immer"],star:!0,lastUpdated:!1}}}}]);